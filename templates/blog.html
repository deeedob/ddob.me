{% extends "base.html" %}

{% block content %}

{% set blog = get_section(path="blog/_index.md") %}
{% set sorted_posts = blog.pages | sort(attribute="date") | reverse %}

<section class="max-w-4xl mx-auto px-4 py-12">

  <header class="text-center mb-12">
    <h1 class="text-4xl font-bold text-content">{{ blog.title | default(value="Blog") }}</h1>
    {% if blog.description %}
      <p class="text-content-muted text-lg mt-2">{{ blog.description | safe }}</p>
    {% endif %}
  </header>

  {% if sorted_posts and sorted_posts | length > 0 %}
    <ul class="space-y-10">
      {% for post in sorted_posts %}
        {% set link = post.extra.permalink | default(value=post.permalink) %}
        {% set_global cover = "" %}

        {# Pick first valid image as cover #}
        {% if post.assets and post.assets | length > 0 %}
          {% for asset in post.assets %}
            {% set a = asset | lower %}
            {% if a is containing(".jpg") or a is containing(".jpeg") or a is containing(".png") or a is containing(".webp") or a is containing(".gif") %}
              {% set_global cover = asset %}
              {% break %}
            {% endif %}
          {% endfor %}
        {% endif %}

        <li class="group">
          <a href="{{ link }}" class="flex gap-6 bg-panel rounded-xl shadow-xl/20
            hover:shadow-primary hover:shadow-xl/40 hover:-translate-y-1 transition-all duration-700 ease-in-out overflow-hidden">

            {# Cover Image #}
            {% if cover %}
              {% set pos = post.extra.image_position | default(value="50%") %}
              <img
                src="{{ get_url(path=cover) | safe }}"
                alt="{{ post.title }}"
                class="w-44 h-44 object-cover object-center flex-shrink-0"
                loading="lazy"
                style = "object-position: 50% {{ pos }};"
              >
            {% else %}
              <div class="w-44 h-44 bg-gradient-to-br from-primary/20 to-secondary/20 flex-shrink-0"></div>
            {% endif %}

            {# Content #}
            <div class="flex flex-col justify-between p-6 flex-grow">
              <div>
                {% if post.date %}
                  <span class="text-xs text-content-muted">
                    {{ post.date | date(format="%b %e, %Y") }}
                  </span>
                {% endif %}

                <h2 class="text-2xl font-semibold text-content group-hover:text-primary transition-colors duration-200 mt-2">
                  {{ post.title }}
                </h2>

                {% if post.summary %}
                  <p class="text-content-muted text-sm mt-3">{{ post.summary | safe }}</p>
                {% endif %}
              </div>

              {# Tags #}
              {% if post.taxonomies and post.taxonomies.tags %}
                <div class="flex flex-wrap gap-2 mt-4">
                  {% for tag in post.taxonomies.tags %}
                    <span class="text-[0.7rem] font-medium bg-primary/10 text-primary px-2 py-0.5 rounded-full border border-primary/20 hover:bg-primary/20 transition-colors duration-200">
                      {{ tag }}
                    </span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

          </a>
        </li>

      {% endfor %}
    </ul>
  {% else %}
    <p class="text-center text-content-muted mt-10">
      No posts found in <code>content/blog/</code>.
    </p>
  {% endif %}

</section>

{% endblock content %}

